<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Lan√ßar Venda</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .carrinho-table th {
            background: #f1f5f9;
            font-size: 0.8rem;
        }

        .carrinho-table td {
            font-size: 0.88rem;
            padding: 0.5rem 0.75rem;
        }

        .carrinho-vazio {
            text-align: center;
            color: #94a3b8;
            padding: 1rem;
            font-style: italic;
        }

        .total-bar {
            background: #1e293b;
            color: white;
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            margin-top: 1rem;
        }

        .total-bar .label {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .total-bar .value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .pgto-btn {
            padding: 0.4rem 0.9rem;
            border-radius: 999px;
            border: 2px solid #e2e8f0;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all .2s;
        }

        .pgto-btn.active {
            background: #16a34a;
            color: white;
            border-color: #16a34a;
        }

        .pgto-btn:not(.active):hover {
            border-color: #16a34a;
            color: #16a34a;
        }

        .btn-add {
            background: #2563eb;
            color: white;
            padding: 0.5rem 1.25rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
        }

        .btn-add:hover {
            background: #1d4ed8;
        }

        .btn-finalizar {
            background: #16a34a;
            color: white;
            width: 100%;
            padding: 0.85rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            margin-top: 0.75rem;
        }

        .btn-finalizar:hover {
            background: #15803d;
        }

        .btn-finalizar:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .remove-item {
            color: #ef4444;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
        }

        /* Hist√≥rico */
        .hist-table {
            font-size: 0.82rem;
        }

        .hist-table th {
            background: #f8fafc;
            font-size: 0.78rem;
        }
    </style>
</head>

<body>

    <!-- ===== MODAL CUPOM DE VENDA ===== -->
    <div id="modalCupom"
        style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:2000; align-items:center; justify-content:center;">
        <div
            style="background:white; border-radius:0.75rem; padding:1.5rem; width:min(400px,95vw); box-shadow:0 20px 60px rgba(0,0,0,0.4);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h3 style="font-size:1rem; font-weight:700;">üßæ Cupom de Venda</h3>
                <button onclick="fecharCupom()"
                    style="background:none;border:none;font-size:1.2rem;cursor:pointer;color:#94a3b8;">‚úï</button>
            </div>
            <!-- √Årea do cupom (impress√£o t√©rmica b√°sica) -->
            <div id="cupomConteudo"
                style="font-family:'Courier New',monospace; font-size:12px; border:1px dashed #cbd5e1; border-radius:0.5rem; padding:1rem; background:#fafafa; max-height:400px; overflow-y:auto;">
                <!-- Preenchido via JS -->
            </div>
            <div style="display:flex; gap:0.5rem; margin-top:1rem;">
                <button onclick="fecharCupom()"
                    style="flex:1; padding:0.6rem; border:2px solid #e2e8f0; border-radius:0.5rem; background:white; cursor:pointer; font-size:0.85rem;">Fechar</button>
                <button onclick="imprimirCupomAgora()"
                    style="flex:2; padding:0.6rem; background:#16a34a; color:white; border:none; border-radius:0.5rem; font-weight:600; cursor:pointer; font-size:0.85rem;">üñ®Ô∏è
                    Imprimir</button>
            </div>
        </div>
    </div>

    <!-- Modal Finalizar Venda -->

    <div id="modalFinalizar"
        style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
        <div
            style="background:white; border-radius:1rem; padding:2rem; width: min(460px, 95vw); box-shadow:0 20px 60px rgba(0,0,0,0.3);">
            <h3 style="margin-bottom:1rem; font-size:1.1rem;">üí≥ Finalizar Venda</h3>
            <div style="background:#f8fafc; border-radius:0.5rem; padding:1rem; margin-bottom:1rem;">
                <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
                    <span style="color:#64748b; font-size:0.85rem;">Subtotal</span>
                    <span id="modalSubtotal" style="font-weight:600;">R$ 0,00</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
                    <span style="color:#64748b; font-size:0.85rem;">Desconto Total</span>
                    <span id="modalDesconto" style="color:#ef4444; font-weight:600;">- R$ 0,00</span>
                </div>
                <hr style="margin:0.5rem 0;">
                <div style="display:flex; justify-content:space-between;">
                    <span style="font-weight:700;">Total</span>
                    <span id="modalTotal" style="font-weight:700; font-size:1.15rem; color:#16a34a;">R$ 0,00</span>
                </div>
            </div>
            <div style="margin-bottom:1rem;">
                <label style="font-size:0.85rem; font-weight:600; display:block; margin-bottom:0.5rem;">Forma de
                    Pagamento</label>
                <div style="display:flex; gap:0.5rem; flex-wrap:wrap;" id="pgtoOpcoes">
                    <button class="pgto-btn" data-pgto="√Ä Vista" data-prazo="0" data-auto="pago">üíµ √Ä Vista</button>
                    <button class="pgto-btn" data-pgto="PIX" data-prazo="0" data-auto="pago">üì± PIX</button>
                    <button class="pgto-btn" data-pgto="Cart√£o D√©bito" data-prazo="0" data-auto="pago">üí≥
                        D√©bito</button>
                    <button class="pgto-btn" data-pgto="Cart√£o Cr√©dito" data-prazo="30" data-auto="pendente">üí≥
                        Cr√©dito</button>
                    <button class="pgto-btn" data-pgto="Boleto" data-prazo="custom" data-auto="pendente">üìÑ
                        Boleto</button>
                    <button class="pgto-btn" data-pgto="Fiado" data-prazo="custom" data-auto="pendente">ü§ù
                        Fiado</button>
                </div>
            </div>

            <!-- Vencimento din√¢mico (aparece conforme a forma) -->
            <div id="prazoContainer"
                style="display:none; margin-bottom:1rem; background:#f0fdf4; border:1px solid #bbf7d0; border-radius:0.5rem; padding:0.75rem;">
                <div id="prazoInfo" style="font-size:0.82rem; color:#15803d; margin-bottom:0.35rem;"></div>
                <div id="prazoCustom" style="display:none;">
                    <label style="font-size:0.82rem; font-weight:600;">Data de Vencimento</label>
                    <input type="date" id="vencimentoCustom" style="margin-top:0.25rem; width:100%;">
                </div>
            </div>

            <div style="margin-bottom:1rem;">
                <label style="font-size:0.85rem; font-weight:600;">Desconto Geral (R$)</label>
                <input type="number" id="descontoGeralModal" value="0" step="0.01" min="0"
                    style="width:100%; margin-top:0.35rem;">
            </div>
            <div style="display:flex; gap:0.75rem; margin-top:1rem;">
                <button onclick="fecharModal()"
                    style="flex:1; padding:0.7rem; border-radius:0.5rem; border:2px solid #e2e8f0; background:white; cursor:pointer;">Cancelar</button>
                <button onclick="confirmarVenda()" id="btnConfirmarVenda"
                    style="flex:2; padding:0.7rem; border-radius:0.5rem; background:#16a34a; color:white; border:none; font-weight:600; cursor:pointer;">‚úÖ
                    Confirmar Venda</button>
            </div>

        </div>
    </div>

    <main class="main-content p-4 md:p-8 overflow-y-auto">
        <div class="container">
            <h2>üõí Pedido de Venda</h2>

            <!-- SELE√á√ÉO DE CLIENTE E PRODUTO -->
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-bottom:1rem;"
                class="form-grid-container">
                <div class="form-group">
                    <label for="cliente">Cliente</label>
                    <select id="cliente" class="w-full p-2 border border-gray-300 rounded">
                        <option value="Consumidor Interno">Consumidor Interno</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="usuario">Operador</label>
                    <select id="usuario">
                        <option value="Administrador">Administrador</option>
                    </select>
                </div>
            </div>


            <!-- ADICIONAR ITEM -->
            <div
                style="background:#f8fafc; border:1px solid #e2e8f0; border-radius:0.75rem; padding:1rem; margin-bottom:1rem;">
                <h4 style="margin-bottom:0.6rem; font-size:0.85rem; color:#475569; font-weight:600;">‚ûï Adicionar Item ao
                    Pedido</h4>
                <div
                    style="display:grid; grid-template-columns:2fr 0.7fr 0.65fr 0.65fr 0.65fr auto; gap:0.5rem; align-items:end;">
                    <div class="form-group" style="margin:0;">
                        <label for="produto">Produto</label>
                        <select id="produto" class="w-full">
                            <option value="">Carregando...</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label>Pre√ßo Unit.</label>
                        <input type="number" id="precoUnitario" step="0.01" min="0" readonly
                            style="background:#e2e8f0;">
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label for="descontoItemPct">Desc. (%)</label>
                        <input type="number" id="descontoItemPct" step="0.01" min="0" max="100" value="0"
                            placeholder="0">
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label for="descontoItemReais">Desc. (R$)</label>
                        <input type="number" id="descontoItemReais" step="0.01" min="0" value="0" placeholder="0">
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label for="quantidade">Qtd</label>
                        <input type="number" id="quantidade" step="any" min="0.01" placeholder="0">
                    </div>
                    <button class="btn-add" onclick="adicionarItemCarrinho()" style="white-space:nowrap;">+
                        Adicionar</button>
                </div>
                <div
                    style="margin-top:0.4rem; font-size:0.8rem; color:#475569; display:flex; align-items:center; gap:0.4rem;">
                    <span>Subtotal do item:</span>
                    <strong id="subtotalItem" style="color:#16a34a;">‚Äî</strong>
                </div>
            </div>

            <!-- CARRINHO DE PEDIDO -->
            <div class="table-container" style="margin-bottom:0;">
                <!-- Badge: editando rascunho -->
                <div id="editandoBadge"></div>
                <h3>üìã Itens do Pedido</h3>
                <table class="carrinho-table" style="width:100%;">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th style="text-align:center;">Qtd</th>
                            <th>Pre√ßo Unit.</th>
                            <th>Desc.%</th>
                            <th>Subtotal</th>
                            <th style="width:28px;"></th>
                        </tr>
                    </thead>
                    <tbody id="carrinhoItens">
                        <tr>
                            <td colspan="5" class="carrinho-vazio">Nenhum item adicionado ainda.</td>
                        </tr>
                    </tbody>
                </table>

                <!-- TOTAIS + BOT√ïES -->
                <div class="total-bar">
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.5rem;">
                        <div>
                            <div class="label">Total do Pedido</div>
                            <div class="value" id="totalCarrinho">R$ 0,00</div>
                            <div class="label" id="qtdItensLabel" style="margin-top:2px;">0 item(ns)</div>
                        </div>
                        <!-- Dois bot√µes lado a lado, mesmo tamanho -->
                        <div style="display:flex; gap:0.5rem; flex-shrink:0;">
                            <button onclick="salvarRascunho()" id="btnRascunho" disabled style="flex:1; padding:0.55rem 1.1rem; border-radius:0.5rem;
                                       border:2px solid #64748b; background:#f8fafc; color:#334155;
                                       font-weight:600; font-size:0.82rem; cursor:not-allowed;
                                       transition:all 0.15s; white-space:nowrap;"
                                onmouseover="if(!this.disabled){this.style.background='#e2e8f0'}"
                                onmouseout="if(!this.disabled){this.style.background='#f8fafc'}">
                                üíæ Rascunho
                            </button>
                            <button id="btnFinalizar" disabled onclick="abrirModal()" style="flex:1; padding:0.55rem 1.1rem; border-radius:0.5rem;
                                       border:none; background:#16a34a; color:white;
                                       font-weight:700; font-size:0.82rem; cursor:not-allowed;
                                       transition:all 0.15s; white-space:nowrap;">
                                ‚úÖ Finalizar ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

            </div>

            <div id="statusMessage" style="margin-top:1rem;"></div>

            <!-- HIST√ìRICO DE VENDAS -->
            <div class="table-container" style="margin-top:2rem;">
                <h3>üìä Hist√≥rico de Vendas Recentes</h3>
                <table class="hist-table" style="width:100%;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Operador</th>
                            <th>Itens</th>
                            <th>Pagamento</th>
                            <th>Status</th>
                            <th>Total</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="listaHistorico">
                        <tr>
                            <td colspan="9" style="text-align:center; padding:1rem; color:#94a3b8;">Carregando...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="js/config.js"></script>
    <script src="js/main.js"></script>
    <script src="js/vendas.js"></script>
</body>

</html>